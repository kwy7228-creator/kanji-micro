<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kanji Micro · 200 (JPT 750)</title>
  <style>
    :root { color-scheme: light; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", sans-serif; background:#f7f5f2; color:#141821; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px; }
    header { display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; }
    h1 { margin:0; font-size:18px; }
    .muted { color:#6b7280; font-size:12px; line-height:1.4; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .pill { font-size:12px; padding:6px 10px; border:1px solid #e1dbd3; border-radius:999px; background:#fff; }
    .btn { border:0; padding:10px 12px; border-radius:10px; background:#2f6fed; color:#fff; cursor:pointer; font-weight:800; }
    .btn.secondary { background:#111827; }
    .btn.ghost { background:#fff; color:#111827; border:1px solid #d9d2c8; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }

    .tabs { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    .tab { border:1px solid #d9d2c8; background:#fff; padding:8px 10px; border-radius:10px; cursor:pointer; font-weight:800; }
    .tab.active { background:#1f2937; color:#fff; border-color:#1f2937; }

    .grid { display:grid; grid-template-columns: 1fr; gap:14px; margin-top:14px; }
    @media (min-width: 920px){ .grid { grid-template-columns: 1fr 1fr; } }

    .card { background:#fff; border:1px solid #e6dfd7; border-radius:14px; padding:16px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    .kanjiRow { display:flex; gap:14px; align-items:flex-end; flex-wrap:wrap; }
    .kanji { font-size:64px; line-height:1; font-weight:900; }
    .meta { display:flex; flex-direction:column; gap:6px; }
    .meta .small { font-size:12px; color:#5a6475; }

    .section { margin-top: 12px; display:grid; gap:10px; }
    .label { font-size:12px; color:#6b7280; font-weight:900; letter-spacing:.08em; text-transform: uppercase; }
    .item { background:#fbfaf8; border:1px solid #eee7df; border-radius:12px; padding:10px 12px; }
    .jp { font-size:15px; font-weight:900; }
    .sub { font-size:13px; color:#4b5563; margin-top:4px; }

    .quizBox { display:grid; gap:12px; }
    .q { font-weight:900; white-space:pre-wrap; }
    .choices { display:grid; gap:8px; margin-top:8px; }
    .choice { text-align:left; background:#fff; border:1px solid #e6dfd7; padding:10px 12px; border-radius:10px; cursor:pointer; font-weight:900; }
    .choice.correct { border-color:#16a34a; outline:2px solid rgba(22,163,74,.2); }
    .choice.wrong { border-color:#dc2626; outline:2px solid rgba(220,38,38,.2); }

    code { background:#f3f4f6; padding:2px 6px; border-radius:6px; }
    .footer { margin-top: 16px; font-size:12px; color:#6b7280; line-height:1.5; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Kanji Micro · 200 (JPT 750)</h1>
        <div class="muted">한자 → 단어 → 문장 → 문장 듣기 · 최근 5일 복습 퀴즈 · 파트5 빈칸</div>
      </div>
      <div class="row">
        <span id="todayPill" class="pill"></span>
        <button id="regenBtn" class="btn">오늘 3개 생성</button>
        <button id="ttsBtn" class="btn ghost">TTS 테스트</button>
      </div>
    </header>

    <div class="tabs">
      <button class="tab active" data-tab="learn">학습</button>
      <button class="tab" data-tab="review">복습(최근 5일)</button>
      <button class="tab" data-tab="part5">파트5 빈칸</button>
      <button class="tab" data-tab="settings">설정</button>
    </div>

    <main id="view"></main>

    <div class="footer">
      - 기록은 브라우저 <code>localStorage</code>에 저장됩니다(PC/브라우저 바뀌면 초기화될 수 있음).<br/>
      - 지금은 “초보용 200개” 버전입니다. 이후 2136으로 확장 가능(형식 동일).
    </div>
  </div>

<script>
/* =========================
   1) 초보용 200개 한자 리스트
   ========================= */
const KANJI_LIST_200 = [
  "日","月","火","水","木","金","土","年","今","時","分","先","後","前","間","半","毎","朝","昼","夜",
  "人","男","女","子","友","私","彼","家","母","父","兄","姉","弟","妹","名","方","国","外","京","市",
  "大","小","多","少","新","古","長","短","高","安","強","弱","早","遅","明","暗","楽","苦","近","遠",
  "上","下","左","右","中","内","入","出","行","来","帰","歩","走","見","聞","言","話","読","書","食",
  "飲","買","売","作","使","持","取","置","立","座","休","働","教","習","学","校","試","験","合","格",
  "会","社","員","部","課","同","関","係","議","計","画","案","実","施","定","決","要","必","確","認",
  "報","連","相","資","料","提","供","受","付","送","達","配","備","整","理","改","善","増","減","費",
  "利","損","得","価","額","率","比","較","選","択","例","像","形","点","線","面","章","題","問","答",
  "練","習","説","明","意","味","思","考","感","情","心","頭","体","病","医","薬","運","動","旅","館",
  "車","駅","空","港","道","橋","電","気","力","音","声","写","真","映","画","歌","英","語","数","理"
];

/* =========================
   2) 유틸
   ========================= */
function uniq(arr){ return Array.from(new Set(arr)); }
function shuffle(arr){
  const a = arr.slice();
  for (let i=a.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function escapeHtml(str){
  return String(str)
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#039;");
}
function escapeAttr(str){ return escapeHtml(str).replace(/"/g,"&quot;"); }

/* =========================
   3) DB 자동 생성(초보용 템플릿)
   ========================= */
function pickOther(list, k){
  let other = k;
  for (let i=0; i<10 && other === k; i++){
    other = list[Math.floor(Math.random()*list.length)];
  }
  return "（" + other + "）";
}

function buildDBFromKanjiList(list){
  const templates = {
    words: (k) => ([
      {jp: k + "語", y: "—", kr: "관련 단어(예시)"},
      {jp: k + "学", y: "—", kr: "관련 단어(예시)"},
      {jp: "基" + k, y: "—", kr: "관련 단어(예시)"}
    ]),
    sentences: (k) => ([
      {jp: "この（" + k + "）は重要です。", kr: "이 ( " + k + " )는 중요합니다."},
      {jp: "（" + k + "）について説明します。", kr: "( " + k + " )에 대해 설명하겠습니다."}
    ]),
    cloze: (k, all) =>
